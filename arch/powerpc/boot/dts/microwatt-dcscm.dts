/dts-v1/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/leds/leds-pca955x.h>

/ {
	#size-cells = <0x02>;
	#address-cells = <0x02>;
	model-name = "microwatt-dcscm";
	compatible = "microwatt-soc";

	aliases {
		serial0 = &UART0;
		serial1 = &VUART;
		i2c0 = &i2c0;
		i2c1 = &i2c1;
		i2c2 = &i2c2;
		i2c3 = &i2c3;
		i2c4 = &i2c4;
		i2c5 = &i2c5;
		i2c6 = &i2c6;
		i2c7 = &i2c7;
		i2c8 = &i2c8;
		i2c9 = &i2c9;
		i2c10 = &i2c10;
		i2c11 = &i2c11;
		i2c12 = &i2c12;
		i2c13 = &i2c13;
	};

	reserved-memory {
		#size-cells = <0x02>;
		#address-cells = <0x02>;
		ranges;

		/* LPC FW cycle bridge region requires natural alignment */
		flash_memory: region@c000000 {
			reg = <0x00000000 0x0c000000 0x00000000 0x04000000>; /* 64M */
		};
	};

	memory@0 {
		device_type = "memory";
		reg = <0x00000000 0x00000000 0x00000000 0x10000000>;
	};

	cpus {
		#size-cells = <0x00>;
		#address-cells = <0x01>;

		ibm,powerpc-cpu-features {
			display-name = "Microwatt";
			isa = <3000>;
			device_type = "cpu-features";
			compatible = "ibm,powerpc-cpu-features";

			mmu-radix {
				isa = <3000>;
				usable-privilege = <2>;
			};

			little-endian {
				isa = <2050>;
				usable-privilege = <3>;
				hwcap-bit-nr = <1>;
			};

			cache-inhibited-large-page {
				isa = <2040>;
				usable-privilege = <2>;
			};

			fixed-point-v3 {
				isa = <3000>;
				usable-privilege = <3>;
			};

			no-execute {
				isa = <2010>;
				usable-privilege = <2>;
			};

			floating-point {
				hwcap-bit-nr = <27>;
				isa = <0>;
				usable-privilege = <3>;
			};
		};

		PowerPC,Microwatt@0 {
			i-cache-sets = <2>;
			ibm,dec-bits = <64>;
			reservation-granule-size = <64>;
			clock-frequency = <100000000>;
			timebase-frequency = <100000000>;
			i-tlb-sets = <1>;
			ibm,ppc-interrupt-server#s = <0>;
			i-cache-block-size = <64>;
			d-cache-block-size = <64>;
			d-cache-sets = <2>;
			i-tlb-size = <64>;
			cpu-version = <0x990000>;
			status = "okay";
			i-cache-size = <0x1000>;
			ibm,processor-radix-AP-encodings = <0x0c 0xa0000010 0x20000015 0x4000001e>;
			tlb-size = <0>;
			tlb-sets = <0>;
			device_type = "cpu";
			d-tlb-size = <128>;
			d-tlb-sets = <2>;
			reg = <0>;
			general-purpose;
			64-bit;
			d-cache-size = <0x1000>;
			ibm,chip-id = <0>;
		};
	};

	soc@c0000000 {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <1>;
		interrupt-parent = <&ICS>;

		ranges = <0 0 0xc0000000 0x40000000>;

		syscon@0 {
			compatible = "microwatt,syscon";
			reg = <0x0 0x100>;
		};

		interrupt-controller@4000 {
			compatible = "openpower,xics-presentation", "ibm,ppc-xicp";
			ibm,interrupt-server-ranges = <0x0 0x1>;
			reg = <0x4000 0x100>;
		};

		ICS: interrupt-controller@5000 {
			compatible = "openpower,xics-sources";
			interrupt-controller;
			interrupt-ranges = <0x10 0x10>;
			reg = <0x5000 0x100>;
			#address-cells = <0>;
			#size-cells = <0>;
			#interrupt-cells = <2>;
		};

		spi@6000 {
			compatible = "openpower,microwatt-spi";
			reg = <0x6000     0x100
			       0x30000000 0x8000000 >;
			#address-cells = <1>;
			#size-cells = <0>;
			flash@0 {
				reg = < 0 >;
				compatible = "jedec,spi-nor";
				spi-max-frequency = <50000000>;

				partitions {
					compatible = "fixed-partitions";
					#address-cells = <1>;
					#size-cells = <1>;

					gateware@0 {
						reg = <0x0 0x400000>; // 4M
						label = "gateware";
					};

					u-boot@400000 {
						reg = <0x400000 0x400000>; // 4M
						label = "u-boot";
					};

					spare@800000 {
						reg = <0x800000 0x7f0000>; // 7.9M
						label = "spare";
					};

					u-boot-env@400000 {
						reg = <0xff0000 0x10000>; // 64K
						label = "u-boot-env";
					};
				};
			};
		};

		UART0: serial@2000 {
			device_type = "serial";
			compatible = "ns16550";
			reg = <0x2000 0x8>;
			clock-frequency = <100000000>;
			current-speed = <115200>;
			reg-shift = <2>;
			fifo-size = <16>;
			interrupts = <0x10 0x1>;
		};

		ethernet@8020000 {
			compatible = "litex,liteeth";
			reg = <0x8021000 0x100
				0x8020800 0x100
				0x8030000 0x2000>;
			reg-names = "mac", "mido", "buffer";
			litex,rx-slots = <2>;
			litex,tx-slots = <2>;
			litex,slot-size = <0x800>;
			interrupts = <0x11 0x1>;
		};

		litex-mmc@8040000 {
			compatible = "litex,mmc";
			reg = <0x8042800 0x800
			       0x8041000 0x800
			       0x8040800 0x800
			       0x8042000 0x800
			       0x8041800 0x800>;
			reg-names = "phy", "core", "reader", "writer", "irq";
			bus-width = <4>;
			interrupts = <0x13 1>;
			cap-sd-highspeed;
			non-removeable;
			no-sd;
		};

		gpioA: gpio@7000 {
			compatible = "openpower,microwatt-gpio";
			gpio-controller;
			#gpio-cells = <2>;
			reg = <0x7000 0x100>;
			interrupts = <0x14 1>;
			ngpios = <32>;
		};

		gpioB: gpio@7100 {
			compatible = "openpower,microwatt-gpio";
			gpio-controller;
			#gpio-cells = <2>;
			reg = <0x8000 0x100>;
			interrupts = <0x15 1>;
			ngpios = <32>;
		};

		/* LPC units */
		VUART: serial@b000000 {
			device_type = "serial";
			compatible = "ns16550";
			reg = <0xb000000 0x8>;
			clock-frequency = <100000000>;
			current-speed = <115200>;
			reg-shift = <2>;
			fifo-size = <16>;
			interrupts = <0x16 0x1>;
		};

		ibt@b001000 {
                        compatible = "ibm,microwatt-ibt-bmc";
                        reg = <0x0b001000 0x18>;
			interrupts = <0x17 0x1>;
                };

		lpc-ctrl@b002000 {
                        compatible = "ibm,microwatt-lpc-ctrl";
                        reg = <0x0b002000 0x10>;
                        memory-region = <&flash_memory>;
                };
	};

	i2c0: i2c0 {
		status = "disabled";
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c1: i2c1 {
		/* not connected - GPIOs unavailable */
		status = "disabled";
	};

	i2c2: i2c2 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 6 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 7 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c3: i2c3 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 8 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 9 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c4: i2c4 {
	        /* GPIOS clash with USB, moved to TPM header */
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioA 23 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioA 20 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c5: i2c5 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 12 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 13 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c6: i2c6 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioA 14 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 15 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c7: i2c7 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 16 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 17 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c8: i2c8 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 18 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 19 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c9: i2c9 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 20 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 21 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c10: i2c10 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 22 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 23 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c11: i2c11 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 24 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 25 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c12: i2c12 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 26 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 27 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	i2c13: i2c13 {
		status = "disabled";
		compatible = "i2c-gpio";
		scl-gpios = <&gpioB 28 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		sda-gpios = <&gpioB 29 (GPIO_ACTIVE_HIGH|GPIO_OPEN_DRAIN)>;
		#size-cells = <0>;
		#address-cells = <1>;
	};

	fsi: gpio-fsi {
		compatible = "fsi-master-gpio", "fsi-master";
		#address-cells = <2>;
		#size-cells = <0>;
		no-gpio-delays;

		clock-gpios = <&gpioA 24 GPIO_ACTIVE_HIGH>;
		data-gpios = <&gpioA 25 GPIO_ACTIVE_HIGH>;
		enable-gpios = <&gpioA 26 GPIO_ACTIVE_HIGH>;
		mux-gpios = <&gpioA 21 GPIO_ACTIVE_HIGH>;
		trans-gpios = <&gpioA 22 GPIO_ACTIVE_HIGH>;
	};

	gpio-keys-polled {
		compatible = "gpio-keys-polled";
		poll-interval = <1000>;

		fan0-presence {
			label = "fan0-presence";
			gpios = <&pca0 4 GPIO_ACTIVE_LOW>;
			linux,code = <4>;
		};

		fan1-presence {
			label = "fan1-presence";
			gpios = <&pca0 5 GPIO_ACTIVE_LOW>;
			linux,code = <5>;
		};

		fan2-presence {
			label = "fan2-presence";
			gpios = <&pca0 6 GPIO_ACTIVE_LOW>;
			linux,code = <6>;
		};

		fan3-presence {
			label = "fan3-presence";
			gpios = <&pca0 7 GPIO_ACTIVE_LOW>;
			linux,code = <7>;
		};
	};

	chosen {
		bootargs = "root=/dev/nfs nfsroot=192.168.0.3:/srv/nfsroot/witherspoon-microwatt-openbmc,nfsvers=3 ip=dhcp";
		//bootargs = "debug";
		ibm,architecture-vec-5 = [19 00 10 00 00 00 00 00 00 00 00 00 00 00 00 00
					  00 00 00 00 00 00 00 00 40 00 40];
		stdout-path = &UART0;
	};
};

&gpioA {
	gpio-line-names =
	/* 0-3 */	"user-led-0", "user-led-1", "user-led-2", "",
	/* 4-7 */	"", "", "", "",
	/* 8-11 */	"power-button", "power-ok", "standby-enable", "",
	/* 12-15 */	"", "", "", "",
	/* 16-19 */	"i2c3-mux-sel", "", "", "",
	/* 20-23 */	"", "fsi-mux", "fsi-trans", "i2c5-scl",
	/* 24-27 */	"fsi-clk", "fsi-dat", "fsi-enable", "",
	/* 28-31 */	"", "", "checkstop", ""; /* checkstop is fake */
};

&gpioB {
	gpio-line-names =
	/* 0-3 */	"i2c0-scl", "i2c0-sda", "i2c1-scl", "i2c1-sda",
	/* 4-7 */	"i2c2-scl", "i2c2-sda", "i2c3-scl", "i2c3-sda",
	/* 8-11 */	"i2c4-scl", "i2c4-sda", "", "i2c5-sda",
	/* 12-15 */	"i2c6-scl", "i2c6-sda", "i2c7-scl", "i2c7-sda",
	/* 16-19 */	"i2c8-scl", "i2c8-sda", "i2c9-scl", "i2c9-sda",
	/* 20-23 */	"i2c10-scl", "i2c10-sda", "i2c11-scl", "i2c11-sda",
	/* 24-27 */	"i2c12-scl", "i2c12-sda", "", "",
	/* 28-31 */	"", "", "", "";
};

&i2c3 {
	status = "okay";

	bmp: bmp280@77 {
		compatible = "bosch,bmp280";
		reg = <0x77>;
		#io-channel-cells = <1>;
	};

	max31785@52 {
		compatible = "maxim,max31785a";
		reg = <0x52>;
		#address-cells = <1>;
		#size-cells = <0>;
	};

	dps: dps310@76 {
		compatible = "infineon,dps310";
		reg = <0x76>;
		#io-channel-cells = <0>;
	};

	pca0: pca9552@60 {
		compatible = "nxp,pca9552";
		reg = <0x60>;
		#address-cells = <1>;
		#size-cells = <0>;

		gpio-controller;
		#gpio-cells = <2>;

		gpio@0 {
			reg = <0>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@1 {
			reg = <1>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@2 {
			reg = <2>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@3 {
			reg = <3>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@4 {
			reg = <4>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@5 {
			reg = <5>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@6 {
			reg = <6>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@7 {
			reg = <7>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@8 {
			reg = <8>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@9 {
			reg = <9>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@10 {
			reg = <10>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@11 {
			reg = <11>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@12 {
			reg = <12>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@13 {
			reg = <13>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@14 {
			reg = <14>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@15 {
			reg = <15>;
			type = <PCA955X_TYPE_GPIO>;
		};
	};

	power-supply@68 {
		compatible = "ibm,cffps1";
		reg = <0x68>;
	};

	power-supply@69 {
		compatible = "ibm,cffps1";
		reg = <0x69>;
	};
};

&i2c4 {
	status = "okay";

	tmp423a@4c {
		compatible = "ti,tmp423";
		reg = <0x4c>;
	};

	ir35221@70 {
		compatible = "infineon,ir35221";
		reg = <0x70>;
	};

	ir35221@71 {
		compatible = "infineon,ir35221";
		reg = <0x71>;
	};
};


&i2c5 {
	status = "okay";

	tmp423a@4c {
		compatible = "ti,tmp423";
		reg = <0x4c>;
	};

	ir35221@70 {
		compatible = "infineon,ir35221";
		reg = <0x70>;
	};

	ir35221@71 {
		compatible = "infineon,ir35221";
		reg = <0x71>;
	};
};

&i2c9 {
	status = "okay";

	tmp275@4a {
		compatible = "ti,tmp275";
		reg = <0x4a>;
	};
};

&i2c10 {
	/* MUX
	 *   -> PCIe Slot 3
	 *   -> PCIe Slot 4
	 */
	status = "okay";
};

&i2c11 {
	status = "okay";

	pca9552: pca9552@60 {
		compatible = "nxp,pca9552";
		reg = <0x60>;
		#address-cells = <1>;
		#size-cells = <0>;
		gpio-controller;
		#gpio-cells = <2>;

		gpio-line-names = "PS_SMBUS_RESET_N", "APSS_RESET_N",
			"GPU0_TH_OVERT_N_BUFF",	"GPU1_TH_OVERT_N_BUFF",
			"GPU2_TH_OVERT_N_BUFF", "GPU3_TH_OVERT_N_BUFF",
			"GPU4_TH_OVERT_N_BUFF",	"GPU5_TH_OVERT_N_BUFF",
			"GPU0_PWR_GOOD_BUFF", "GPU1_PWR_GOOD_BUFF",
			"GPU2_PWR_GOOD_BUFF", "GPU3_PWR_GOOD_BUFF",
			"GPU4_PWR_GOOD_BUFF", "GPU5_PWR_GOOD_BUFF",
			"12V_BREAKER_FLT_N", "THROTTLE_UNLATCHED_N";

		gpio@0 {
			reg = <0>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@1 {
			reg = <1>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@2 {
			reg = <2>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@3 {
			reg = <3>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@4 {
			reg = <4>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@5 {
			reg = <5>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@6 {
			reg = <6>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@7 {
			reg = <7>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@8 {
			reg = <8>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@9 {
			reg = <9>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@10 {
			reg = <10>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@11 {
			reg = <11>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@12 {
			reg = <12>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@13 {
			reg = <13>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@14 {
			reg = <14>;
			type = <PCA955X_TYPE_GPIO>;
		};

		gpio@15 {
			reg = <15>;
			type = <PCA955X_TYPE_GPIO>;
		};
	};

	rtc@32 {
		compatible = "epson,rx8900";
		reg = <0x32>;
	};

	eeprom@51 {
		compatible = "atmel,24c64";
		reg = <0x51>;
	};

	ucd90160@64 {
		compatible = "ti,ucd90160";
		reg = <0x64>;
	};
};

&i2c12 {
	status = "okay";
};

&i2c13 {
	status = "okay";
};

#include "ibm-power9-dual.dtsi"
